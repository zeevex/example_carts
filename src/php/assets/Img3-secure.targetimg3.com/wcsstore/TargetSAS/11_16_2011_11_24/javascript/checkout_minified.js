$(document).ready(function(){Target.controller.checkoutUtils.init()});var requestSubmitted=false;
Target.controller.checkoutUtils={init:function(){this.loadInterface()},loadInterface:function(){this.initializeFormControls();this.handleGiftCards();this.handlePromoCodes();this.handleEmployeeNumbers();this.registerValidationMethods();this.handleSingleAddressChoice();this.handleCreditCards();this.handleShippingAddresses();this.handleGiftChoices();this.handleShippingSelectChange();this.handleCreditCardChange();this.tooltips.setup();this.bindSubmitButtons();this.saveItemQuantities();this.hideShowSecurityCode();
this.openTDCoverlay()},submitRequest:function(){if(!requestSubmitted)return requestSubmitted=true;return false},handleShippingOnload:function(){var a=$("#sameAsShipping").parent().parent().find("p.address");if(document.getElementById("sameAsShipping")!=null)if(document.getElementById("sameAsShipping").checked==true){$("#billing-address ol").css("display","none");a.css({opacity:0,display:"block"}).removeClass("hidden").stop().animate({opacity:1},250)}else $("#billing-address ol").css("display","block")},
initializeFormControls:function(){var a=this;$("#confirmEmail").bind("paste",function(d){d.preventDefault()});$("#phone1").attr("maxlength","20");$("#billingPhone").attr("maxlength","20");$("#phone1").mask("(999) 999-9999");$("#shippingPhone").mask("(999) 999-9999");$("#state-other").hide();$("#billingCountry").length>0&&a.phoneMask();$("#billingCountry").live("change",function(){a.phoneMask()});$("body").delegate("#promoCode","keyup",function(){$("#promo-form p.error-message.error-continue").remove()});
var b=$("#sameAsShipping").parent().parent().find("p.address");if($("#sameAsShipping").is(":checked")==true){$("#billing-address .input-step").css("display","none");b.css({opacity:0,display:"block"}).removeClass("hidden").stop().animate({opacity:1},250)}else $("#billing-address .input-step").css("display","block");$("#sameAsShipping").bind("change",function(){var d=$(this).parent().parent().find("p.address");this.checked?$("#billing-address .input-step").stop().animate({opacity:0},250,function(){$(this).css("display",
"none");d.css({opacity:0,display:"block"}).removeClass("hidden").stop().animate({opacity:1},250)}):d.stop().animate({opacity:0},250,function(){$(this).css("display","none");$("#billing-address .input-step").css({opacity:0,display:"block"}).stop().animate({opacity:1},250)})});$("#createAccount").bind("change",function(){var d=$("#create-account-section");this.checked?d.fadeIn():d.fadeOut(function(){d.find("p.error-message").remove()})});if($("#onLoadSts").val()==="Y"){b=$("select#ccType option:selected").attr("class");
var c=$("select#savedCreditCards option:selected").attr("class");b!=undefined&&a.showHideCardDetails(b);c!=undefined&&a.showHideCardDetails(c)}$("body").delegate("select#ccType, select#savedCreditCards","change keydown",function(){var d=$(this).find("option:selected").attr("class");a.showHideCardDetails(d);a.hideShowSecurityCode();a.changeMaxLength(this)});$("body").delegate("#editCard","overlay-before-show",function(){$("#ccType").trigger("change")});$("textarea[maxlength]").bind("keyup",function(){var d=
$(this).val(),e=parseInt($(this).attr("maxlength")),f=d.length;f>e?$(this).val(d.substr(0,e)):$("label[for="+$(this).attr("id")+"] span").html(e-f)});$("body").delegate("#editCard","overlay-show",function(){var d=$(this),e=typeof $("#ccType").val()!=="undefined"?$("#ccType").val():null;d.find(".tipnoteTrigger").tipNote();$("#phone1").attr("maxlength","20");$("#billingPhone").attr("maxlength","20");if(e=="Target Card"||e=="Target Business Card")a.hideShowSecurityCode();$("#billingCountry").trigger("change")});
$("body").delegate("#editAddress","overlay-show",function(){$("#shippingPhone").mask("(999) 999-9999")});$("body").delegate("#addAddress","overlay-show",function(){$("#shippingPhone").mask("(999) 999-9999")})},phoneMask:function(){if($("#billingPhone").val()!=""){var a=$("#billingPhone").val().replace(/[^0-9\.]/g,"");$("#billingPhone").val(a)}$("#billingCountry").val()!="US"&&$("#billingPhone").unmask("(999) 999-9999");$("#billingCountry").val()=="US"&&$("#billingPhone").mask("(999) 999-9999");var b=
[];a=$(this).val();if(a!==""){if(a==="US"){b.push("zip code");b.push("phone");$("#state-us").show();$("#state-other").hide();$("#billingState2").hide().attr("disabled","disabled")}else{b.push("postal code");b.push("country code + phone number");$("#state-us").hide();$("#state-other").removeClass("hidden").show();$("#intAddress").val("International")}$("label .lTitle").each(function(c){$(this).text(b[c])})}},normalizeColumnHeight:function(a){var b=0;a.each(function(){var c=$(this),d=c.height();if(c.css("height").replace("px",
"")>c.css("minHeight").replace("px",""))b=d>b?d:b});b&&a.height(b)},bindSubmitButtons:function(){function a(){var c=$("#orderSubmitURL").val();$.ajax({url:c,type:"post",success:function(d){var e;d=d.replace("/*","");d=d.replace("*/","");try{e=$.parseJSON(d)}catch(f){$("#errorMessage").html("<h3>Oops, An Exception Occured</h3><br/>Please contact Administrator <br/><br/>");return requestSubmitted=false}if(e.orderId){Target.controller.reviewed.cookie.erase("cartQty");if($("#createAccount").is(":checked")){$("#order-summary").attr("action",
"CheckoutGuestRegistrationAdd");$("#order-summary").submit()}else{d=$("#confirmOrderURL").val();document.location.href=d}}else if(e.errorMessageKey=="_ERR_DIDNT_LOGON"||e.errorMessageKey=="_ERR_USER_AUTHORITY")document.location.href="CheckoutSignInView";else if(e.errorMessageKey=="DECLINE_CARD"||e.errorMessageKey=="INVALID_PAYMENT")document.location.href="CheckoutOrderBillingView?paymentFailureFlag=Y";else if(e.errorMessageKey=="DECLINE_EXCEEDED_MAX"){Target.controller.reviewed.cookie.erase("cartQty");
Target.controller.reviewed.cookie.erase("guestDisplayName");document.location.href=$("#LogoffURL").val()}else if(e.errorMessageKey=="DECLINE_CARD_INVALID_PIN")if($("#tdcPinFlag").val()==1){d=$("#errorPinMesg").val();$("#errorMessage").html("<h3>Oops, An Exception Occured</h3><br/>"+d+"<br/><br/>");requestSubmitted=false;$("input[name=tcPinNum]").val("");$("input[name=password_tcPinNum]").val("");$("#formPin").validate().element("#password_tcPinNum")}else document.location.href="CheckoutOrderBillingView?paymentFailureFlag=I";
else if(e.errorMessageKey=="DECLINE_CARD_TIME_OUT")document.location.href="CheckoutOrderBillingView?paymentFailureFlag=T";else if(e.errorMessageKey=="DECLINE_CARD_NEGATIVE")document.location.href="CheckoutOrderBillingView?paymentFailureFlag=N";else if(e.errorMessageKey=="DECLINE_CARD_CERTEGY")document.location.href="CheckoutOrderBillingView?paymentFailureFlag=C";else if(e.errorMessageKey=="DECLINE_CARD_MAX_INV")document.location.href="CheckoutOrderBillingView?paymentFailureFlag=M";else if(e.errorMessageKey==
"DECLINE_CARD_TDC")document.location.href="CheckoutOrderBillingView?paymentFailureFlag=D";else if(e.errorMessageKey=="ADDRESS_NULL")document.location.href="CheckoutOrderShippingView";else if(e.errorMessageKey=="NO_TRACKING_EMAIL_ID_ERR")document.location.href="CheckoutOrderBillingView?paymentFailureFlag=EM";else if(e.errorMessageKey=="SESSION_INACTIVE")document.location.href="OrderItemDisplay?sessionInactiveError=Yes";else{$("#errorMessage").html("<h3>Oops, An Exception Occured</h3><br/>"+e.errorMessage+
"<br/><br/>");requestSubmitted=false;if($("#tdcPinFlag").val()==1){$("input[name=tcPinNum]").val("");$("input[name=password_tcPinNum]").val("");$("#formPin").validate().element("#password_tcPinNum")}}}})}var b=this;$("#payment-submit").bind("click",function(){if(b.checkPromoCode())return false;if(null!=document.getElementById("paypalChk")&&document.getElementById("paypalChk").value=="PAYPAL")window.location.href="SingleShipmentOrderSummaryView?storeId="+document.getElementById("storeId").value+"&catalogId="+
document.getElementById("catalogId").value+"&langId="+document.getElementById("langId").value+"&orderId="+document.getElementById("orderId").value;else $(".payment-form").submit();return false});$("#shipping-submit").bind("click",function(){if(null!=document.getElementById("noDefaultAddress")&&null!=document.getElementById("noDefaultAddress").value&&document.getElementById("noDefaultAddress").value=="Y"){saveGiftOrMobileAddress();document.location.reload()}else{if(!$("#cart-form").valid())return false;
var c=null;c=document.getElementById("is-gift").checked?"yes":"no";var d=null;d=null!=document.getElementById("signature")&&document.getElementById("signature").checked?"Y":"N";var e=null;e=null!=document.getElementById("sigRequiredFlg")?document.getElementById("sigRequiredFlg").value:"N";document.getElementById("signFlag").value=d;if(null!=document.getElementById("sigRequired"))document.getElementById("sigRequired").value=e;document.getElementById("giftOptions").value=c;if(document.getElementById("noaddress")!=
null){c=$("#shipping-address-form");if($("#shipping-address-form").valid()){c=c;c.serialize();Target.controller.avs.HandleAvsResponse(c)}}else{document.getElementById("ESPOptionsDisplayURL");document.getElementById("orderId");$("#cart-form").serialize();$("#cart-form").attr("action");c=$("#cart-form");Target.controller.avs.HandleAvsResponse(c)}}return false});$(".serverError").css("display","none");$("input.service-plan").bind("change",function(){var c="N";if($(this).is(":checked"))c="Y";var d=$(this).attr("value"),
e=$("input[name=orderId]").val(),f=$("input[name=orderItemId_"+d+"]").val(),g=$("input[name=catentryId_"+d+"]").val();c="orderId="+e+"&orderItemId="+f+"&catentryId="+g+"&espCheck="+c;e=$("input[name=addRemoveWarrantyURL]").val();$("#service-plans-form").attr("action",e);$.post($("#service-plans-form").attr("action"),c,function(h){h=$.parseJSON(h);if(h.esp_success=="Y")b.getOrderShippingSummaryResponse();else{h.isEspCheck=="Y"?$("input[name=plan-"+d+"]").removeAttr("checked"):$("input[name=plan-"+
d+"]").attr("checked","checked");$("#espItemsError_"+d).css("display","block");$("#espItemsError_"+d).html(h.errorMessage)}})});$("#gift-options-submit").bind("click",function(){giftOptionsSetProperties()});$("#errorPrint").bind("click",function(c){c.preventDefault();$("#tdcServerError").jqprint();return false});$("body").delegate("#order-submit-alt,#order-submit","click",function(){if(b.submitRequest()){if($("#tdcPinFlag").val()==1){if($("#formPin").validate().element("#password_tcPinNum")==false)return requestSubmitted=
false;var c=$("input[name=tcPinNum]").val();if(c!==undefined){var d=$("#AddPinURL").val();$.ajax({url:d,type:"post",data:"tcPinNum="+c,success:function(e){var f;try{f=$.parseJSON(e)}catch(g){$("#errorMessage").html("<h3>Oops, An Exception Occured</h3><br/>Please contact Administrator <br/><br/>");return requestSubmitted=false}if(f.checkoutMarkup[0].updated=="Y"&&f.checkoutMarkup[0].errorKey=="")a();else{requestSubmitted=false;$("#errorMessage").html("<h3>Oops, An Exception Occured</h3><br/>Error while adding Pin for Target Debit Card Payment.<br/><br/>");
return false}}})}else{requestSubmitted=false;$("#errorMessage").html("<h3>Oops, An Exception Occured</h3><br/>Pin not entered for Target Debit Card.<br/><br/>");return false}}else a();return false}});$("#confirmation-print").bind("click",function(){var c=(screen.width-615)/2,d=(screen.height-795)/2,e;e="height=795,";e+="width=615,";e+="top="+d+",";e+="left="+c+",";e+="toolbar=0, scrollbars=1, location=0, statusbar=0 ,menubar=0 ,resizable=0";window.open($(this).attr("href"),"CartPrintablePage",e);
return false});$("body").delegate("#checkout-edititems-submit","click",function(){var c=$("#checkoutedititems-form"),d=$("input[name=editItemsContinue]").val();c.attr("action",d);c.submit();return false});$("body").delegate("#esp-options-submit","click",function(){var c=$("#service-plans-form"),d=$("input[name=continueURL]").val();c.attr("action",d);c.submit();return false});$("#primary").delegate("p.remove a","click",function(){b.removeItem($(this).parents(".action").find("form"));return false});
$("#primary").delegate("div.save a","click",function(){$("body").showCurtain();$(this).closest("form").submit();return false});$("#primary").delegate("form.updateQty","submit",function(){b.submitUpdatedQuantity(this);return false})},checkPromoCode:function(){if($("#promoCode").val()!=""){$("#promo-form p.error-message").hide();$("#promo-form p.error-message.error-continue").remove();$("#promoCode").after('<p class="error-message error-continue">Please make sure you click apply for your promo code to ensure you get your discount.</p>');
return true}else return false},registerValidationMethods:function(){$.validator.addMethod("shouldRequireCreditCard",function(){return $("#credit-card-details").is(":visible")?true:false});$.validator.addMethod("shouldRequireBillingAddress",function(){return $("#billing-address").is(":visible")?true:false});$.validator.addMethod("shouldRequireTrackingEmail",function(){return $("#order-tracking").length?true:false});$.validator.addMethod("validInternationalPhoneNumber",function(a){return a.match(/^\d{10,20}$/)});
$.validator.addMethod("validCity",function(a){return a.match(/^[a-z|A-Z]+[a-z|A-Z|\-\.\s]*$/)});$.validator.addMethod("ccExp",function(a,b,c){a=(new Date).getMonth()+1;b=(new Date).getFullYear();var d=parseInt($(c.month).val(),10),e=parseInt($(c.year).val(),10);return $(c.year).is(":visible")?e>b||e===b&&d>=a:true})},updateOrderSummary:function(a){$.each(a,function(b,c){if(c!="")switch(b){case "checkoutMarkup":$("#cartSummary .content").html(c[0].markup);break;case "promoError":if(c[0].markup=="Y"){if(c[0].errorType==
"D")$("#srvrside-error-mgs .error-message.duplicate-error").show();else{$("#srvrside-error-mgs .error-message").html(c[0].errorMsg);$("#srvrside-error-mgs .error-message").show();$("#srvrside-error-mgs .error-message.duplicate-error").hide()}$("#redeem-code #promoCodeOs,#redeem-code .applyPromoCode").show();$("#redeem-code #promoCodeOs").val($("#oldPromoCode").val())}}})},updateCreditCard:function(a){$("#credit-card-details .fieldset-content").html(a.ccMarkup[0].markup);$("#address-value").html(a.ccMarkup[1].markup)},
updateShippingAddress:function(a,b){$("#address-choices").html(a.shippingMarkup[0].markup);this.handleSingleAddressChoice();if(b.length===0)b=$("select.shipping-address");b.prepend(a.shippingMarkup[1].markup);b.each(function(){$(this).find("option")[0].selected=true});self.normalizeColumnHeight($("div.address"))},handleDiscountResponse:function(a,b,c){a.find("input[type=text]").val("");a.find("p.error-message").remove();var d=a.find(".results"),e=a.find(".balance-message.card");if(d.length)if(arguments.length===
4&&e.length)e.replaceWith(c);else if(arguments.length===4)d.prepend(c);else{d.children().not(".card").remove();d.append(c)}else b.append('<div class="results">'+c+"</div>")},handleGiftCards:function(){var a=this;$("#payWithGiftcard").bind("change",function(){if(this.checked)$("#gift-card-payment ol, #gift-card-payment .results").fadeIn().find("input:first").focus();else{$("#applied-gift-cards .remove").trigger("click");$("#gift-card-payment .results").remove();$("#gift-card-form").data().validator.resetForm();
$("#gift-card-payment ol, #gift-card-payment .results").fadeOut()}});$("#apply-gift-card").bind("click",function(){$("#gift-card-form").attr("subAction","apply");if(null!=document.getElementById("gcApply"))document.getElementById("gcApply").value="Y";$("#gift-card-form").submit();$("#gift-card-form").attr("subAction","");return false});$("#check-balance").bind("click",function(){$("#gift-card-form").attr("subAction","check");$("#gift-card-form").submit();$("#gift-card-form").attr("subAction","");
return false});$("body").delegate("#applied-gift-cards .remove","click",function(){a.removeGiftCard($(this).attr("id"));return false});var b=false;$("#giftCardNumber").bind("keyup change",function(){if($(this).val().length==14){$("#giftCardAccess").attr("disabled","disabled").addClass("chkGiftCardDisabled");b=true}else b&&$("#giftCardAccess").removeAttr("disabled").removeClass("chkGiftCardDisabled")})},submitGiftCard:function(){var a=$("#gift-card-form").serialize(),b=$("#gift-card-form").attr("subAction");
a+="&operation=giftCard&subAction="+b;cardNumber=$("input[id=giftCardNumber]").val();accessNumber=$("input[id=giftCardAccess]").val();hasErrorGC="N";$.ajax({url:$("#gift-card-form").attr("action"),data:a,dataType:"json",type:"post",success:function(c){var d=[$("#gift-card-form"),$("#gift-card-payment"),c.checkoutMarkup[0].markup];if(b==="check")d.push("checkBalance");else if(b==="apply"&&c.checkoutMarkup[0].haserror!="Y"){var e=$("#gift-card-form").find(".balance-message.card");e.length&&e.replaceWith("")}$(".addtoCartDisabled").removeAttr("disabled",
"disabled");if(c.checkoutMarkup[0].haserror=="Y"){d=$("#gift-card-form").find(".giftCardErrorHolder");c=c.checkoutMarkup[0].markup;hasErrorGC="Y";d.append(c);return false}else{Target.controller.checkoutUtils.handleDiscountResponse.apply(this,d);b!="check"&&Target.controller.checkoutUtils.getOrderSummaryResponse()}$("#giftCardAccess").removeAttr("disabled");typeof c.checkoutMarkup[0]=="object"&&c.checkoutMarkup[0].giftCount>0?$("button[name=apply-gift-card]").find(".buttonText").text("apply another."):
$("button[name=apply-gift-card]").find(".buttonText").text("apply.");if(typeof c.checkoutMarkup[0].coversOrder!="undefined"&&c.checkoutMarkup[0].coversOrder==="true"){$("#creditCardRequired").val("N");$("#credit-card-details, #billing-address, #payment-form .error-summary").hide();d=$("#ccType").val();if(d==null||d=="")$("#ccType").val("Visa")}else{$("#creditCardRequired").val("Y");$("#credit-card-details, #billing-address").show()}if(typeof c.checkoutMarkup[0].giftCount!="undefined"&&c.checkoutMarkup[0].giftCount===
"4"){$(".form-section.giftcardsection").hide();c.checkoutMarkup[0].coversCovers=="false"&&$("#credit-card-details").show()}else $(".form-section.giftcardsection").show();if(b=="check"||hasErrorGC=="Y"){$("input[id=giftCardNumber]").val(cardNumber);$("input[id=giftCardAccess]").val(accessNumber);if(accessNumber==""||accessNumber==null)$("#giftCardAccess").attr("disabled","disabled").addClass("chkGiftCardDisabled")}}});return false},removeGiftCard:function(a){a=$("#payWithGiftcard:checked").length?
"operation=giftCard&subAction=remove&id="+a+"&piId="+a:"operation=giftCard&subAction=remove&id="+a+"&piId=*";$.ajax({url:$("#gift-card-form").attr("action"),data:a,dataType:"json",type:"post",success:function(b){if(b){var c=$("#gift-card-form .results");c.html(b.checkoutMarkup[0].markup);c.attr({tabindex:"-1",role:"alert"}).focus();$("#gift-card-form .giftCardErrorHolder").html("");Target.controller.checkoutUtils.getOrderSummaryResponse();if(typeof b.checkoutMarkup[0].coversOrder!="undefined"&&b.checkoutMarkup[0].coversOrder===
"true"){$("#creditCardRequired").val("N");$("#credit-card-details, #billing-address").hide()}else{null!=$("#ccNumber")&&$("#ccNumber")!="undefined"&&$("#ccNumber").val().length==0&&$("#ccType").val("Select One");$("#creditCardRequired").val("Y");$("#credit-card-details, #billing-address").show()}typeof b.checkoutMarkup[0]=="object"&&b.checkoutMarkup[0].giftCount>0?$("button[name=apply-gift-card]").find(".buttonText").text("apply another."):$("button[name=apply-gift-card]").find(".buttonText").text("apply.");
if(typeof b.checkoutMarkup[0].giftCount!="undefined"&&b.checkoutMarkup[0].giftCount==="4")$(".form-section.giftcardsection").hide();else{b.checkoutMarkup[0].coversOrder=="false"&&$("#credit-card-details").show();$("#payWithGiftcard:checked").length?$(".form-section.giftcardsection").show():$(".form-section.giftcardsection").hide()}}}});return false},handlePromoCodes:function(){var a=this;$("body").delegate("#redeem-code-label","click",function(b){b.preventDefault();$(this).addClass("clicked");$("#redeem-code #promoCodeOs").val("").show().focus();
$("#redeem-code .applyPromoCode, #redeem-code #promoCodeLabel").show()});$("body").delegate("#redeem-code .applyPromoCode","click",function(b){b.preventDefault();if($("#redeem-code").validate().form()){$("#oldPromoCode").val($("#redeem-code #promoCodeOs").val());a.redeemCode()}else $("#srvrside-error-mgs").hide()});$("body").delegate("#redeem-code #promoCodeOs","keyup",function(b){b.preventDefault();$("#redeem-code").validate().form();$("#srvrside-error-mgs").hide()});$("body").delegate("#applied-codes .remove",
"click",function(){a.removePromoCode($(this).attr("id"));return false});$("body").delegate("#multi-promo-code .remove","click",function(){a.removePromoCode($(this).attr("id"));return false})},redeemCode:function(){var a=this,b=$("#viewName").val(),c="";c=null!=document.getElementById("currentPage")?$("#currentPage").val():"";var d=null;d=null!=document.getElementById("fromShipSummary")&&document.getElementById("fromShipSummary").value=="Y"?"OrderShippingSummaryResponse":"OrderSummaryResponse";shipView=
b=="CheckoutOrderShippingView"?1:0;$.ajax({url:"PromotionCodeManage",type:"post",data:{promoCode:$("#promoCodeOs").val(),shipView:shipView,orderId:$("#orderId").val(),authToken:$("#WC_authToken").val(),operation:"redeemCode",taskType:"A",currentPage:c,VIEW:d},dataType:"json",success:function(e){if(e.promoError[0].markup=="Y"){$("#redeem-code p.error-message").remove();$("#srvrside-error-mgs").show();Target.controller.checkoutUtils.updateOrderSummary(e)}else{Target.controller.checkoutUtils.updateOrderSummary(e);
$("#redeem-code-label").text("redeem another promotion code");$("#redeem-code #promoCodeOs,#redeem-code .applyPromoCode,#redeem-code p.error-message").hide();$("#redeem-code-label").removeClass("clicked");a.refreshPromotion()}}})},submitPromoCode:function(){$.ajax({url:"PromotionCodeManage",type:"post",data:{promoCode:$("#promoCode").val(),orderId:$("#orderId").val(),authToken:$("#WC_authToken").val(),operation:"redeemCode",taskType:"A",VIEW:"CheckoutPromoAjaxView"},dataType:"json",success:function(a){var b=
$("#multi-promo-code");$("#promo-form p.error-message.error-continue").remove();b.html(a.checkoutMarkup[0].markup);if(a.checkoutMarkup[0].haserror=="Y"){$('#promo-form .error-message.invalid-error"').html(a.checkoutMarkup[0].errorMsg);$('#promo-form .error-message.invalid-error"').css({display:"block",visibility:"visible"});$('#promo-form .error-message.invalid-error"').show()}else if(a.checkoutMarkup[0].haserror=="D")$('#promo-form .error-message.duplicate-error"').css({display:"block",visibility:"visible"});
else{$("#srvrside-error-mgs1").hide();$("#promoCode").val("")}Target.controller.checkoutUtils.getOrderSummaryResponse();$(document).ready(function(){$("input[name=hasPromoCodeValue]").val()=="Y"?$("button[name=applyPromoCode]").find(".buttonText").text("apply another."):$("button[name=applyPromoCode]").find(".buttonText").text("apply.")});$(".addtoCartDisabled").removeAttr("disabled","disabled")}})},removePromoCode:function(a){$.ajax({url:"PromotionCodeManage",type:"post",data:{promoCode:$("#promoCode_"+
a).val(),orderId:$("#orderId").val(),authToken:$("#WC_authToken").val(),operation:"redeemCode",taskType:"R",VIEW:"CheckoutPromoAjaxView"},dataType:"json",success:function(b){$("#multi-promo-code").html(b.checkoutMarkup[0].markup);b.checkoutMarkup[0].haserror=="Y"?$(".error-message").css({display:"block",visibility:"visible"}):$("#srvrside-error-mgs1").hide();Target.controller.checkoutUtils.getOrderSummaryResponse();$(document).ready(function(){$("input[name=hasPromoCodeValue]").val()=="Y"?$("button[name=applyPromoCode]").find(".buttonText").text("apply another."):
$("button[name=applyPromoCode]").find(".buttonText").text("apply.")});$(".addtoCartDisabled").removeAttr("disabled","disabled")}})},refreshPromotion:function(){var a=$("#multi-promo-code");null!=a&&null!=a.html()&&$.ajax({url:"CheckoutPromoAjaxView?orderId="+$("#orderId").val(),dataType:"json",success:function(b){a.html(b.checkoutMarkup[0].markup)}})},handleEmployeeNumbers:function(){var a=this;$("#employee-form .applyPromoCode").bind("click",function(){$("#redeem-code").submit();return false});$("body").delegate("#applied-team-member .remove",
"click",function(){a.removeEmployeeNumber($(this).attr("id"));return false})},submitEmployeeNumber:function(){var a="",b=$("#employee-form").serialize();b+="&operation=employeeNumber";$.ajax({url:$("#employee-form").attr("action"),data:b,dataType:"json",type:"post",success:function(c){Target.controller.checkoutUtils.handleDiscountResponse($("#employee-form"),$("#employee-form"),c.tmdHTML);if(c.success_case=="Y"){a=c.pageName!==undefined?c.pageName:"";$("button[name=apply-employee-number]").hide();
$("input[id=employeeNumber]").hide();Target.controller.checkoutUtils.getOrderSummaryResponse(a)}c.empErrorMsg=="Y"&&$("#employee-form").find("#employeeNumber").parent().append('<p class="error-message">sorry. that employee number is invalid</p>');$(".addtoCartDisabled").removeAttr("disabled","disabled")}});return false},removeEmployeeNumber:function(a){a="operation=employeeNumber&subAction=remove&id="+a;$.ajax({url:$("#employee-form").attr("action"),data:a,dataType:"json",type:"post",success:function(b){$("#employee-form .results").html(b.checkoutMarkup[0].markup);
Target.controller.checkoutUtils.updateOrderSummary(b.checkoutMarkup[1].markup);$("button[name=apply-employee-number]").show();$("input[id=employeeNumber]").show()}});return false},updateLTLShipMsg:function(a,b){var c=a.split("(")[0].trim();$("#signDiv-"+b).hide();if(null!=c){$("#signDiv-"+b).show();if(c.toUpperCase()=="Inside the door".toUpperCase())$("#signDiv-"+b).html("Item delivered inside your door. Appointment and signature Required.");else if(c.toUpperCase()=="To The Door".toUpperCase())$("#signDiv-"+
b).html("Item delivered to your doorstep.");else if(c.toUpperCase()=="Room of choice".toUpperCase())$("#signDiv-"+b).html("Item delivered to room of choice.");else if(c.toUpperCase()=="White glove".toUpperCase())$("#signDiv-"+b).html("Item delivered with white glove.");else c.toUpperCase()=="White glove assembly".toUpperCase()?$("#signDiv-"+b).html("Item delivered with white glove assembly."):$("#signDiv-"+b).html("")}},handleShippingSelectChange:function(){var a=this;$("select.shipping-type").bind("change",
function(){var b=this.id.substring(this.id.indexOf("-")+1),c=$(this).find(":selected").attr("key");document.getElementById("orderItemId"+b);var d=$("#orderItemQty"+b).val(),e=$("#EstimatedArrival-"+b).val(),f="false";if(null!=document.getElementById("freeGift-"+b)){document.getElementById(b);d="&orderItemId="+b+"&shipmodeId="+c+"&shpModeDesc="+e+"&eddUpdateFlg=Y&operation=shipType&shipType="+c+"&allocate=***&backorder=***&calculationUsage=-1%2C-2%2C-4%2C-5%2C-6%2C-7&catalogId=10051&check=*n&langId=-1&orderId=.&orderItemId_1="+
b+"&remerge=***&requesttype=ajax&qty_1="+d+"&shipModeId_1="+c+"&storeId=10151";$.ajax({data:d,url:"GWPurchase",type:"post",success:function(g){var h=$.trim(g);h=$.parseJSON(g);$("#invalidShipMethod-error-"+b).hide();if(null!=h&&null!=h.shipModeVerifyMarkup[0]&&null!=h.shipModeVerifyMarkup[0].errorMessage&&h.shipModeVerifyMarkup[0].errorMessage!="undefined"){$("#invalidShipMethod-error-"+b).html(h.shipModeVerifyMarkup[0].errorMessage).css({color:"red"});$("#invalidShipMethod-error-"+b).show();f="true"}if(null!=
h&&null!=h.shipModeVerifyMarkup[0].freeShipmode){$("#freeGift-"+b).text(h.shipModeVerifyMarkup[0].freeShipmode);$("#signatureMsg"+b).text(h.shipModeVerifyMarkup[0].freeShipmode)}if(null!=h&&null!=h.shipModeVerifyMarkup[0].promoHtml){$("#PromoDummyHtml-"+b).html(h.shipModeVerifyMarkup[0].promoHtml);$("#PromoDummyHtml-"+b).show();$("#promoHtml-"+b).hide()}if(c=="12060"&&null!=document.getElementById("signature-option")||null!=h.shipModeVerifyMarkup[0].hideSigOption&&h.shipModeVerifyMarkup[0].hideSigOption==
"Y"){document.getElementById("signature-option").style.display="none";if(null!=document.getElementById("signature")&&document.getElementById("signature").checked)document.getElementById("signature").checked=false}else if(null!=document.getElementById("sigRequired")&&document.getElementById("sigRequired").value=="Y"||null!=h.shipModeVerifyMarkup[0].hideSigOption&&h.shipModeVerifyMarkup[0].hideSigOption=="N"){document.getElementById("signature-option").style.display="block";if(null!=document.getElementById("sigRequired")&&
document.getElementById("sigRequired").value=="N"){document.getElementById("sigRequired").value="Y";document.getElementById("sigRequiredFlg").value="Y"}}$.hideCurtain()}})}else{d="&orderItemId="+b+"&shipmodeId="+c+"&shpModeDesc="+e+"&eddUpdateFlg=Y&operation=shipType&shipType="+c+"&allocate=***&backorder=***&calculationUsage=-1%2C-2%2C-4%2C-5%2C-6%2C-7&catalogId=10051&check=*n&langId=-1&orderId=.&orderItemId_1="+b+"&remerge=***&requesttype=ajax&qty_1="+d+"&shipModeId_1="+c+"&storeId=10151";$.ajax({data:d,
url:"GWPurchase",type:"post",success:function(g){g=$.parseJSON(g);$("#invalidShipMethod-error-"+b).hide();if(null!=g&&null!=g.shipModeVerifyMarkup[0].errorMessage&&g.shipModeVerifyMarkup[0].errorMessage!="undefined"){$("#invalidShipMethod-error-"+b).html(g.shipModeVerifyMarkup[0].errorMessage).css({color:"red"});$("#invalidShipMethod-error-"+b).show();f="true"}if(null!=g&&null!=g.shipModeVerifyMarkup[0].promoHtml){$("#PromoDummyHtml-"+b).html(g.shipModeVerifyMarkup[0].promoHtml);$("#PromoDummyHtml-"+
b).show();$("#promoHtml-"+b).hide()}if(c=="12060"&&null!=document.getElementById("signature-option")||null!=g.shipModeVerifyMarkup[0].hideSigOption&&g.shipModeVerifyMarkup[0].hideSigOption=="Y"){document.getElementById("signature-option").style.display="none";if(null!=document.getElementById("signature")&&document.getElementById("signature").checked)document.getElementById("signature").checked=false}else if(null!=document.getElementById("sigRequired")&&document.getElementById("sigRequired").value==
"Y"||null!=g.shipModeVerifyMarkup[0].hideSigOption&&g.shipModeVerifyMarkup[0].hideSigOption=="N"){document.getElementById("signature-option").style.display="block";if(null!=document.getElementById("sigRequired")&&document.getElementById("sigRequired").value=="N"){document.getElementById("sigRequired").value="Y";document.getElementById("sigRequiredFlg").value="Y"}}}})}if(f=="false"){setTimeout(function(){a.getOrderSummaryResponseForShip()},500);null!=e&&a.updateLTLShipMsg(e,b)}});$("select.shipping-address").bind("change",
function(){var b=$(this).find(":selected").val(),c=this.id.replace("cartAddress_","")-1,d=document.getElementById("orderItemId"+c).value;c="&allocate=***&backorder=***&calculationUsage=-1%2C-2%2C-4%2C-5%2C-6%2C-7&catalogId=10051&check=*n&langId=-1&orderId=.&orderItemId_1="+d+"&remerge=***&requesttype=ajax&addressId_1="+b+"&storeId=10151";var e=$("#editAddressSourceURL").val()+"&addressId="+b+"&orderItemId="+d;$(this).parent().find(".modal:first").attr("href",e);$.ajax({data:c,url:"AjaxOrderChangeServiceShipInfoUpdate",
type:"post",success:function(){a.getOrderSummaryResponseForShip();a.getShipMethodsResponse(d);$.ajax({data:"&addressId="+b+"&orderItemId="+d+"&eddUpdateFlg=Y",url:"GWPurchase",type:"post",success:function(f){f=$.parseJSON(f);if(null!=f.shipModeVerifyMarkup[0].hideSigOption&&f.shipModeVerifyMarkup[0].hideSigOption=="Y"){if(document.getElementById("signature-option").style.display=="block")document.getElementById("signature-option").style.display="none"}else if(null!=f.shipModeVerifyMarkup[0].hideSigOption&&
f.shipModeVerifyMarkup[0].hideSigOption=="N")if(document.getElementById("signature-option").style.display=="none")document.getElementById("signature-option").style.display="block";if(null!=document.getElementById("freeGift-"+d)&&null!=document.getElementById("EstimatedArrival-"+d)){f=$("#EstimatedArrival-"+d).val();var g=$("#signatureMsg-"+d),h=$("#signatureMsg-"+d).val();$("#freeGift-"+d).text("Free "+f);null!=g&&$("#signatureMsg"+d).text(h)}$.hideCurtain()}});$("#EstimatedArrival-"+d).find("option").length==
0&&$("#signDiv-"+d).hide()}})})},handleSingleAddressChoice:function(){try{$("#shippingAddress").html($("#shippingAddress").html().replace("address below","address </span> below"));$("a[title='ship items']").each(function(){$(this).attr("title","ship items to"+$(this).parent().find(".address-value").html().split(",")[0]);var g=$(this).parent().find(".address-value").html().replace(/(?:&nbsp;|<br>)/g,"");$(this).find(".buttonText").append('<span class="screen-reader-only">'+g+"</span>")});var a=$(".address-value:first").html().replace(/(?:&nbsp;|<br>)/g,
"");$("#selected-address").append('<span class="screen-reader-only">'+a+"</span>");if(Target.controller.reviewed.cookie.read("BacktoselectedAddress")==window.location.href){$("#selected-address").focus();Target.controller.reviewed.cookie.create("BacktoselectedAddress","",-1)}}catch(b){}var c=$("div.address:gt(2)"),d=this;a="";c.hide();d.normalizeColumnHeight($("div.address"));var e=c.length+3;if(c.length>0)a='<a href="" id="view-all-addresses">view all '+e+" addresses</a>";$("#address-actions").prepend(a);
$("#view-all-addresses").bind("click",function(){c.fadeIn();$("#address-choices > div:nth-child(2) > div:nth-child(1)").focus().attr("role","alert");$("#address-choices > div:nth-child(2) > div:nth-child(1)").attr("tabindex","-1");$(this).hide();return false});var f=$("div.address");f.delegate(".button","click",function(){var g=this,h=$(g).attr("href");$.ajax({data:"",url:h,type:"post",success:function(){var j=$("div.address.selected"),k=$("#selected-address"),l='<a class="button tier-2" id="address-'+
(f.index(j)+1)+'"><span class="buttonText">ship items here.</span></a>';j.removeClass("selected");k.replaceWith(l);$(g).replaceWith(k).parent().addClass("selected");$(k).focus().attr({role:"alert",tabindex:"-1"});$("#saved-shipping-address").val($(g).attr("id"));d.getOrderSummaryResponse();Target.controller.reviewed.cookie.create("BacktoselectedAddress",window.location.href,0);window.location.reload()}});return false})},handleShippingAddresses:function(){$("body").delegate("#addressVerification",
"overlay-before-hide",function(){if($(this).find("form").attr("name")=="thankyouForm")if(document.getElementById("fromPage")!=null&&document.getElementById("fromPage").value=="OrderReview"&&document.getElementById("oldTotal")!=null){$("body").showCurtain();window.location.href="CheckoutOrderShippingView?fromPage=OrderReview&oldTotal="+document.getElementById("oldTotal").value}else{$("body").showCurtain();window.location.href="CheckoutOrderShippingView"}});$("body").delegate("#editAddress","overlay-before-hide",
function(){document.getElementById("fromPage")!=null&&document.getElementById("fromPage").value=="OrderReview"&&document.getElementById("oldTotal")});$("body").delegate("#editAddressOK,#addAddressOK","overlay-before-hide",function(){if(document.getElementById("fromPage")!=null&&document.getElementById("fromPage").value=="OrderReview"&&document.getElementById("oldTotal")!=null){$("body").showCurtain();window.location.href="CheckoutOrderShippingView?fromPage=OrderReview&oldTotal="+document.getElementById("oldTotal").value}else{$("body").showCurtain();
window.location.href="CheckoutOrderShippingView"}});$("body").delegate("#addAddress","overlay-before-hide",function(){document.getElementById("fromPage")!=null&&document.getElementById("fromPage").value=="OrderReview"&&document.getElementById("oldTotal")})},handleCreditCards:function(){$("body").delegate("#addCard","overlay-before-hide",function(){$("body").showCurtain();window.location.href="CheckoutOrderBillingView?viewName=CheckoutOrderBillingView"});var a=$("#billing-address .fieldset-content .address #address-value a").attr("href");
$(".changeThisUrl").overlay({content:a})},handleGiftChoices:function(){var a=this;$("input.giftwrap").bind("change",function(){var b="langId="+document.getElementById("langId").value+"&storeId="+document.getElementById("storeId").value+"&catalogId="+document.getElementById("catalogId").value+"&orderId="+document.getElementById("orderId").value,c=document.getElementById("totalItems").value,d="",e="",f="";for(i=1;i<=c;i++){if(document.getElementById("giftWrap-"+i)){if(document.getElementById("giftWrap-"+
i).checked)b=b+"&giftWrap_"+i+"="+document.getElementById("giftWrap-"+i).value;if(i!=1){d=d+"|giftWrap_"+i+"="+document.getElementById("giftWrap-"+i).value;e=e+"|orderItemId_"+i+"="+document.getElementById("orderItemId_"+i).value;f=f+"|"+document.getElementById("orderItemId_"+i).value+"="+document.getElementById("giftWrap-"+i).checked}else{d="giftWrap_"+i+"="+document.getElementById("giftWrap-"+i).value;e="orderItemId_"+i+"="+document.getElementById("orderItemId_"+i).value;f=document.getElementById("orderItemId_"+
i).value+"="+document.getElementById("giftWrap-"+i).checked}}if(null!=document.getElementById("include-message-"+i)&&document.getElementById("include-message-"+i).checked)b=b+"&message_"+i+"="+document.getElementById("message_"+i).value.trim();if(null!=document.getElementById("orderItemId_"+i)&&document.getElementById("orderItemId_"+i))b=b+"&orderItemId_"+i+"="+document.getElementById("orderItemId_"+i).value}b=b+"&giftWrapItems="+d;b=b+"&giftWrapOrderItems="+e;b=b+"&giftWrapEligItems="+c;b=b+"&selectedOrderItems="+
f;b=b+"&giftWrappableItems="+document.getElementById("giftWrappableItems").value;$.post($("#gift-options").attr("action"),b,function(){a.getOrderShippingSummaryResponse()})});$("input.include-message").each(function(){if($(this).is(":checked")==true){$(this).closest(".action").find(".message-container").fadeIn();$("textarea[maxlength]").trigger("keyup")}});$("input.include-message").bind("change",function(){if(this.checked){$(this).closest(".action").find(".message-container").fadeIn().find("textarea:first").focus();
$("textarea[maxlength]").trigger("keyup")}else $(this).closest(".action").find(".message-container").fadeOut()})},handleCreditCardChange:function(){var a=this;$("#credit-card-details").delegate("#savedCreditCards","change",function(){var b=$(this).find(":selected"),c="operation=ccChange&cardId="+b.val();$.ajax({data:c,url:"BillingAddressResponse",curtain:false,type:"post",success:function(d){d=$.parseJSON(d);$("#ccExpMonth").val(d.checkoutMarkup[0].month);$("#ccExpYear").val(d.checkoutMarkup[0].year);
$("#address-value").html(d.checkoutMarkup[0].markup);$("#card-actions").html(d.checkoutMarkup[0].href);$("#isAuthenticated").val(d.checkoutMarkup[0].isAuthenticated);$("#card-actions .modal:first, #billing-address .fieldset-content .address a").each(function(){var e=$(this).attr("href").replace(/&id=\d*/,"")+"&id="+b.val();$(this).attr("href",e)});a.hideShowSecurityCodeParam()}})})},handleCreditCardLoad:function(){var a=this,b=$("#savedCreditCards").find(":selected"),c="operation=ccChange&cardId="+
b.val();$.ajax({data:c,url:"BillingAddressResponse",curtain:false,type:"post",success:function(d){d=$.parseJSON(d);$("#ccExpMonth").val(d.checkoutMarkup[0].month);$("#ccExpYear").val(d.checkoutMarkup[0].year);$("#address-value").html(d.checkoutMarkup[0].markup);$("#card-actions").html(d.checkoutMarkup[0].href);$("#isAuthenticated").val(d.checkoutMarkup[0].isAuthenticated);$("#card-actions .modal:first, #billing-address .fieldset-content .address a").each(function(){var e=$(this).attr("href").replace(/&id=\d*/,
"")+"&id="+b.val();$(this).attr("href",e)});a.hideShowSecurityCodeParam()}})},getOrderShippingSummaryResponse:function(){var a=this;$.ajax({data:"catalogId=10051&storeId=10151",url:"OrderShippingSummaryResponse",type:"post",success:function(b){b=$.parseJSON(b);a.updateOrderSummary(b)}})},getOrderSummaryResponse:function(a){var b="catalogId=10051&storeId=10151";if(a!==undefined&&a&&a!=="")b+="&pageName="+a;var c=this;$.ajax({data:b,url:"OrderSummaryResponse",type:"post",success:function(d){d=$.parseJSON(d);
c.updateOrderSummary(d)}})},getOrderSummaryResponseForShip:function(){var a=this;$.ajax({data:"catalogId=10051&storeId=10151&shipView=1",url:"OrderShippingSummaryResponse",type:"post",success:function(b){b=$.parseJSON(b);a.updateOrderSummary(b)}})},getShipMethodsResponse:function(a){var b=this;$.ajax({data:"catalogId=10051&storeId=10151&orderItemId_1="+a+"&orderItemId="+a,url:"ShipMethodsResponse",type:"post",datatype:"json",success:function(c){c=$.parseJSON(c);$("#EstimatedArrival-"+a).html(c.shipMethodsMarkup[0].shipMethods);
b.updateLTLShipMsg($("#EstimatedArrival-"+a).find("option:selected").text(),a);console.log($("#shipGblErrMsg"));$("#shipGblErrMsg").hide();$("#shipGblErrMsg-temp").hide();$("#itemErrDiv-temp-"+a).hide();$("#itemErrDiv-"+a).hide();$("#seasonalMsg-temp-"+a).hide();$("#whenevermsg-temp-"+a).hide();$("#seasonalMsg-"+a).hide();$("#whenevermsg-"+a).hide();$("#EstimatedArrival-"+a).find("option").length==0&&$("#signDiv-"+a).hide();if(c.shipMethodsMarkup[0].shipMethods==""){$("#shipGblErrMsg-temp").show();
$("#itemErrDiv-temp-"+a).show()}else{$("div[id^='itemErrDiv-']:visible").length>0&&$("#shipGblErrMsg").show();if(c.shipMethodsMarkup[0].seasonal){$("#seasonalMsg-temp-"+a).css({display:"block",visibility:"visible"});$("#seasonalMsg-temp-"+a).html(c.shipMethodsMarkup[0].seasonal)}if(c.shipMethodsMarkup[0].whenever){$("#whenevermsg-temp-"+a).css({display:"block",visibility:"visible"});$("#whenevermsg-temp-"+a).html(c.shipMethodsMarkup[0].whenever)}}}})},hideShowSecurityCode:function(){var a="N",b=null,
c=ccTypeText=parentElem="";if(null!=document.getElementsByName("emptyCardForm")&&null!=document.getElementsByName("emptyCardForm").item(0))a=document.getElementsByName("emptyCardForm").item(0).value;b=a=="Y"||$.overlay.currentOverlay?$("#ccType"):$("#savedCreditCards");c=$.overlay.currentOverlay?$.overlay.currentOverlay:$("body");ccTypeText=b.find(":selected").text();parentElem=c.find("#credit-card-details").find("#ccCode, #ccExpMonth, #ccExpYear").parent();ccTypeText.search(/Target/i)>=0&&ccTypeText.search(/Target Visa Credit Card/i)==
-1?parentElem.hide().addClass("ignore"):parentElem.show().removeClass("ignore")},changeMaxLength:function(a){a="#"+$(a).attr("id");var b;b=$(a+" :selected").text().search(/American Express/)!=-1?4:3;$(a).parents("form").find("#ccCode").attr("maxlength",b)},hideShowSecurityCodeParam:function(){var a="N",b=null;b=parentElem=isAuthVal="";var c=$.overlay.currentOverlay?$.overlay.currentOverlay:$("body");if(document.getElementsByName("emptyCardForm"))a=document.getElementsByName("emptyCardForm").item(0).value;
b=a=="Y"||$.overlay.currentOverlay?$("#ccType"):$("#savedCreditCards");b=b.find(":selected").text();parentElem=c.find("#credit-card-details").find("#ccCode, #ccExpMonth, #ccExpYear, #ccCodeSaved").parent();b.search(/Target/i)>=0&&b.search(/Target Visa Credit Card/i)==-1?parentElem.hide().addClass("ignore"):parentElem.show().removeClass("ignore");if(document.getElementById("isAuthenticated"))isAuthVal=document.getElementById("isAuthenticated").value;if(b.search(/Target/i)<0&&b.search(/Target Visa Credit Card/i)==
-1)if(isAuthVal=="Y"||isAuthVal=="Y")c.find("#credit-card-details").find("#ccCode, #ccCodeSaved").parent().hide().addClass("ignore")},submitUpdatedQuantity:function(a){a=$(a);$.ajax({url:a.attr("action"),data:a.serialize()+"&editItemsAction=update",type:"post",dataType:"json",success:function(b){Target.controller.checkoutUtils.refreshCartContents(b);if(b.editItems_success=="Y"){orderItemsString=orderItemsString+"|"+b.oItemId;$("input[name=updatedOrdItems]").val(orderItemsString);$("#quantity_"+b.rowId).addClass("saved")}},
error:function(){window.location.reload()}});$.hideCurtain()},removeItem:function(a){$("#removestatus").val("");$.ajax({url:a.attr("action"),data:a.serialize()+"&editItemsAction=remove",type:"post",dataType:"json",success:function(b){if(b.editItems_success=="Y"){$("input[name=removestatus]").val(b.editItems_success);var c=$("input[name=prtNum_"+b.rowId+"]").val();$("input[name=removedPartNum]").val(c);s_cartRemoval(c)}Target.controller.checkoutUtils.refreshCartContents(b)},error:function(){window.location.reload()}})},
refreshCartContents:function(a){if(a.editItems_success=="Y"){$("ul.refresh_con").replaceWith(a.editItemsHTML);$("input[name=fromPage]").val()!=null&&$("input[name=fromPage]").val()=="ShippingView"?this.getOrderShippingSummaryResponse():Target.controller.checkoutUtils.getOrderSummaryResponse()}else{$("ul.refresh_con").replaceWith(a.editItemsHTML);$("input[name=fromPage]").val()!=null&&$("input[name=fromPage]").val()=="ShippingView"?this.getOrderShippingSummaryResponse():Target.controller.checkoutUtils.getOrderSummaryResponse();
var b=a.rowId,c=a.actQty;$("#qty_"+b).val(c);$("#editItemsError_"+b).show();$("#editItemsError_"+b).html(a.errorMessage);b=$("#quantity_"+b);a.actQuantity!=a.actQty&&b.find(".save").show();b.removeClass("changed");b.removeClass("saved")}this.saveItemQuantities()},saveItemQuantities:function(){$("input.itemQty").each(function(){this.storedValue=$(this).val()}).bind("keyup",function(){$(this).val()!=this.storedValue&&$(this).val()>0?$(this).closest(".qty").removeClass("saved").addClass("changed"):$(this).closest(".qty").removeClass("changed");
$(this).val()==""&&$(this).closest(".qty").removeClass("changed")})},showHideCardDetails:function(a){switch(a){case "targetDebitCard":$(".TCHolder").show();$(".TCHolder div.system-message-graphic p.small").attr({generated:true,role:"alert","aria-live":"rude"});break;case "baseCardClass":$(".TCHolder").hide();$(".TCHolder div.system-message-graphic p.small").attr({generated:"",role:"","aria-live":""})}},openTDCoverlay:function(){var a=$("#isTDC").val(),b=$("#TDCModal").val();a!=="undefined"&&a==="Y"&&
$.overlay.load({content:b,overlayId:"TDC",overlayType:"modal",template:"meduim",closeLink:false})},tooltips:{setup:function(){var a=this;$("sup.tipnoteTrigger a").focus(function(){$(this).parent().toggleClass("tipType-info-focused")});$("sup.tipnoteTrigger").click(function(){$(this).addClass("isFocused")}).blur(function(){$(this).removeClass("isFocused")});$("sup.tipnoteTrigger").live("mouseover click",function(b){$(this).addClass("tipType-info-focused");b.preventDefault();a.showTooltip(this)});$("sup.tipnoteTrigger").live("mouseout blur",
function(b){$(this).removeClass("tipType-info-focused");b.preventDefault();a.hideTooltip(this)})},showTooltip:function(a){a=$(a);var b=a.find(".tooltipBox");b.hide();var c=46;if($.browser.msie)c+=16;a.offset().left+a.width()+b.width()+c>$(document).width()?b.addClass("showLeft"):b.removeClass("showLeft");b.show()},hideTooltip:function(a){$(a).find(".tooltipBox").hide()}}};$(document).ready(function(){Target.controller.checkoutUtils.handleShippingOnload()});
String.prototype.trim=function(){return this.replace(/^\s*/,"").replace(/\s*$/,"")};
function skippingGiftOptions(){var a="OrderCalculate?langId="+document.getElementById("langId").value+"&storeId="+document.getElementById("storeId").value+"&catalogId="+document.getElementById("catalogId").value+"&orderId="+document.getElementById("orderId").value+"&GiftOptionsSubmit=true",b="N";if(document.getElementById("fromPage")!=null&&document.getElementById("fromPage").value=="OrderReview"&&document.getElementById("grandTotal")!=null&&document.getElementById("oldTotal")!=null&&document.getElementById("grandTotal").value==
document.getElementById("oldTotal").value){var c=document.getElementById("totalItems").value;for(i=1;i<=c;i++)if(document.getElementById("giftWrap-"+i))if(document.getElementById("giftWrap-"+i).checked){b="Y";break}window.location.href=b=="N"?a+"&URL=SingleShipmentOrderSummaryView":a+"&URL=CheckoutOrderBillingView"}else window.location.href=a+"&URL=CheckoutOrderBillingView"}
function giftOptionsSetProperties(){var a=document.getElementById("totalItems").value,b="";for(i=1;i<=a;i++)if(document.getElementById("include-message-"+i))b=document.getElementById("include-message-"+i).checked?i!=1?b+"|"+document.getElementById("orderItemId_"+i).value+"=true":document.getElementById("orderItemId_"+i).value+"=true":i!=1?b+"|"+document.getElementById("orderItemId_"+i).value+"=false":document.getElementById("orderItemId_"+i).value+"=false";document.getElementById("selectedOrderItems").value=
b;document.getElementById("URL").value="CheckoutOrderBillingView";document.getElementById("GiftOptionsSubmit").value="true";if(document.getElementById("fromPage")!=null&&document.getElementById("fromPage").value=="OrderReview"&&document.getElementById("grandTotal")!=null&&document.getElementById("oldTotal")!=null&&document.getElementById("grandTotal").value==document.getElementById("oldTotal").value&&document.getElementById("redirectLogic1")!=null&&document.getElementById("redirectLogic1").value!=
"T")document.getElementById("URL").value="SingleShipmentOrderSummaryView"}function continueGiftOptions(){giftOptionsSetProperties();document.forms["gift-options"].submit()}
function saveGiftOrMobileAddress(){try{var a=0;if(null!=document.getElementById("giftOrMobileCounter")&&null!=document.getElementById("giftOrMobileCounter").value)a=document.getElementById("giftOrMobileCounter").value;if(a!=null&&a>0){var b=$("#cart-form").serialize();$.ajax({url:"AddressSaveForEMobile",data:b,type:"post",dataType:"json",success:function(){}})}}catch(c){}};(function(a){a.fn.dPassword=function(b){var c=a.extend({interval:2,duration:100,replacement:"%u25CF",prefix:"password_",debug:false},b),d=[],e=[];a(this).each(function(){c.debug&&console.log("init ["+a(this).attr("id")+"]");var f=a(this).attr("name"),g=a(this).attr("id"),h=a(this).attr("class"),j=a(this).attr("style"),k=a(this).attr("size"),l=a(this).attr("maxlength"),m=a(this).attr("disabled"),n=a(this).attr("tabindex"),o=a(this).attr("accesskey"),p=a(this).attr("value");d.push(g);e.push(g);a(this).hide();
c.debug&&a(this).after('<span id="debug_'+c.prefix+f+'" style="color: #f00;"></span>');a(this).after(' <input name="'+(c.prefix+f)+'" id="'+(c.prefix+g)+'" type="text" value="'+p+'" '+(h!=""?'class="'+h+'"':"")+(j!=""?'style="'+j+'"':"")+(k!=""?'size="'+k+'"':"")+(l!=-1?'maxlength="'+l+'"':"")+(m!=""?'disabled="'+m+'"':"")+(n!=""?'tabindex="'+n+'"':"")+(o!=undefined?'accesskey="'+o+'"':"")+'autocomplete="off" />');a("label[for="+g+"]").attr("for",c.prefix+g);a(this).attr("tabindex","");a(this).attr("accesskey",
"");a("#"+c.prefix+g).bind("focus",function(){c.debug&&console.log("event: focus ["+getId(a(this).attr("id"))+"]");clearTimeout(d[getId(a(this).attr("id"))]);d[getId(a(this).attr("id"))]=setTimeout("check('"+getId(a(this).attr("id"))+"', '')",c.interval)});a("#"+c.prefix+g).bind("blur",function(){c.debug&&console.log("event: blur ["+getId(a(this).attr("id"))+"]");clearTimeout(d[getId(a(this).attr("id"))])});setTimeout("check('"+g+"', '', true);",c.interval)});getId=function(f){RegExp(c.prefix+"(.*)").exec(f);
return f=RegExp.$1};setPassword=function(f,g){c.debug&&console.log("setPassword: ["+f+"]");var h="";for(i=0;i<g.length;i++)h+=g.charAt(i)==unescape(c.replacement)?a("#"+f).val().charAt(i):g.charAt(i);a("#"+f).val(h)};check=function(f,g,h){c.debug&&console.log("check: ["+f+"]");var j=a("#"+c.prefix+f).val();if(g!=j){setPassword(f,j);if(j.length>1){g="";for(i=0;i<j.length-1;i++)g+=unescape(c.replacement);g+=j.charAt(j.length-1);a("#"+c.prefix+f).val(g)}clearTimeout(e[f]);e[f]=setTimeout("convertLastChar('"+
f+"')",c.duration)}c.debug&&a("#debug_"+c.prefix+f).text(a("#"+f).val());h||(d[f]=setTimeout("check('"+f+"', '"+a("#"+c.prefix+f).val()+"', false)",c.interval))};convertLastChar=function(f){if(a("#"+c.prefix+f).val()!=""){var g="";for(i=0;i<a("#"+c.prefix+f).val().length;i++)g+=unescape(c.replacement);a("#"+c.prefix+f).val(g)}}}})(jQuery);var modalOpenedLink;
Target.controller.avs={HandleAvsResponse:function(a){$("#Address-Save").length>0&&$("#Address-Save").attr("disabled","disabled");a=$(a);var b=a.serialize(),c=a.attr("action"),d=false,e="",f="";$.ajax({url:c,data:b,type:"post",dataType:"json",success:function(g){modalOpenedLink="";if(g!=null)if(g.avsFlag=="false"&&g.hasError=="N"){if($.overlay.currentOverlay){e=$.overlay.currentOverlay.attr("id");f=$.overlay.currentOverlay.hasClass("large")?"large":"medium";modalOpenedLink=$("a.overlay-open").attr("href");d=
true}Target.controller.avs.openModal(g,"small","force");return false}else if(g.paymentCnd=="0"&&g.errBillingHtml!=null&&g.avsFlag=="false"&&g.hasError=="Y")Target.controller.avs.openModal(g,"large","",g.paymentCnd);else if(g.hasError=="Y"&&g.errShippingHtml!=null)Target.controller.avs.openModal(g,"medium","",1);else if(g.hasError=="Y"){a.attr("action",g.errorUrl);a.get(0).submit()}else if(g.checkoutFlag=="true")Target.controller.avs.openModal(g,"small","false",g.checkoutFlag);else window.location.href=
g.avsFwdURL},error:function(){$("#Address-Save").removeAttr("disabled");window.location.reload()}});$("body").delegate("#addressVerification","overlay-show",function(){$(this);if(d){if(!self.modalOpenedLink||typeof self.modalOpenedLink=="undefind")modalOpenedLink=$(".avsCancelURL").val();$(this).find("a.button.tier-2").removeClass("cancel").addClass("datamodal")}$("p.error-message").each(function(){$.trim($(this).text()).length==0&&$(this).remove()});return false});$("body").undelegate(".datamodal",
"click").delegate(".datamodal","click",function(){var g=$("#avs").serialize();$.overlay.load({overlayId:e,template:f,content:modalOpenedLink,curtain:true,data:g})});$("body").delegate("#addressVerification","overlay-before-show",function(){$(this).find("#avs").unbind("pausesubmit.overlay").bind("pausesubmit.overlay",function(){Target.controller.avs.submitAVSModal($(this))})});$("body").bind("overlay-hide",function(g,h){if(h==="#addressVerification"){$("#Address-Save").length>0&&$("#Address-Save").removeAttr("disabled");
$("#registryShippingAddress03").length>0&&$("#"+Target.controller.Registry.tempStoreFormId).attr("ACTION",Target.controller.Registry.tempStoreFormAction);$("#shipping-address-new").length>0&&$("#"+Target.controller.TargetList.tempStoreFormId).attr("ACTION",Target.controller.TargetList.tempStoreFormAction)}});return false},submitAVSModal:function(a){var b=$("#avs input:radio[name=avsRadios]:checked").closest("li").attr("id"),c=$("#avs input:hidden");$.each(["personTitle","firstName","middleName","lastName",
"organizationName","address1","address2","city","state","zipCode","phone1","addressField3","phone1Type","status","fax2","phone2Type"],function(f,g){c.filter("[name="+g+"]").val(c.filter("[name="+b+"_"+g+"]").val())});$("#addressVerification").find("#avs.button").attr("disabled","disabled");a=$(a);var d=a.serialize(),e=$("#avs input[name='avsFormAction']").val();$.ajax({url:e,data:d,type:"post",dataType:"json",success:function(f){if(f!=null)if(f.avsFlag=="false"||f.hasError=="Y")if(f.paymentCnd=="1"){a.attr("action",
f.errorUrl);a.get(0).submit()}else if(f.paymentCnd=="0"&&f.errBillingHtml!=null&&f.avsFlag=="false"&&f.hasError=="Y")Target.controller.avs.openModal(f,"large","",f.paymentCnd);else{Target.controller.avs.openModal(f,"small","force");$("#addressVerification").find("p.error-message").each(function(){$.trim($(this).text()).length==0&&$(this).remove()})}else if(f.checkoutFlag=="true")Target.controller.avs.openModal(f,"small","false",f.checkoutFlag);else window.location.href=f.avsFwdURL},error:function(f){window.location.reload();
alert(f)}})},openModal:function(a,b,c,d,e){overlayAjaxCall=e!=null||e!=""?e:a.avsModalURL;if(d=="true"){overlayHtml="";window.location.href=a.avsFwdURL}else if(d=="0"){overlayHtml=a.errBillingHtml;overlayID="editCard"}else if(d=="1"){overlayHtml=a.errShippingHtml;overlayID="addAddress"}else{overlayHtml=a.avsHTML;overlayID=a.avsId}$.overlay.load({contentOverride:overlayHtml,overlayId:overlayID,content:overlayAjaxCall,curtain:true,template:b,mode:c})}};(function(a){var b;a.fn.jqprint=function(c){b=a.extend({},a.fn.jqprint.defaults,c);c=this instanceof jQuery?this:a(this);if(b.operaSupport&&a.browser.opera){var d=window.open("","jqPrint-preview");d.document.open();var e=d.document}else{var f=a("<iframe  />");b.debug||f.css({position:"absolute",width:"0px",height:"0px",left:"-600px",top:"-600px"});f.appendTo("body");e=f[0].contentWindow.document}if(b.importCSS)a("link[media=print]").length>0?a("link[media=print]").each(function(){e.write("<link type='text/css' rel='stylesheet' href='"+
a(this).attr("href")+"' media='print' />")}):a("link").each(function(){e.write("<link type='text/css' rel='stylesheet' href='"+a(this).attr("href")+"' />")});b.printContainer?e.write(c.outer()):c.each(function(){e.write(a(this).html())});e.close();(b.operaSupport&&a.browser.opera?d:f[0].contentWindow).focus();setTimeout(function(){(b.operaSupport&&a.browser.opera?d:f[0].contentWindow).print();d&&d.close()},1E3)};a.fn.jqprint.defaults={debug:false,importCSS:true,printContainer:true,operaSupport:true};
jQuery.fn.outer=function(){return a(a("<div></div>").html(this.clone())).html()}})(jQuery);
